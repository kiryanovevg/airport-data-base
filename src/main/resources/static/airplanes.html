<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Airplanes</title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.min.js"></script>
</head>
<body>

<label for="airplane_model">
    <input type="text" placeholder="Airplane model" id="airplane_model" required>
</label>
<label for="airplane_capacity">
    <input type="text" placeholder="Airplane capacity" id="airplane_capacity" required>
</label>
<label for="airplane_airlineId">
    <input type="text" placeholder="Airline id" id="airplane_airlineId" required>
</label>
<button id="btnAdd" type="submit">Добавить</button>

<br>
<div id="container"></div>

</body>
</html>
<script>
    $(document).ready(function(){
        loadAirplanes();

        $('#btnAdd').click(function () {
            var model = $('#airplane_model').val();
            var capacity = $('#airplane_capacity').val();
            var airlineId = $('#airplane_airlineId').val();

            if (model.trim() && capacity.trim() && airlineId.trim()) {
                addAirplane(model, capacity, airlineId);
            } else {
                alert('Заполните все поля');
            }
        })
    });

    function addAirplane(model, capacity, airlineId) {
        var body = JSON.stringify({
            model: model,
            capacity: capacity,
            airlineId: airlineId
        });

        $.ajax({
            url: "/airplanes",
            type: "POST",
            contentType:"application/json",
            data: body,
            success: function(response) {
                $('#airplane_model').val('');
                $('#airplane_capacity').val('');
                $('#airplane_airlineId').val('');

                loadAirplanes()
            },
            error: function(xhr) {
                showMessage(xhr.responseText)
            }
        });
    }

    function loadAirplanes() {
        setContainer('Loading..');
        $.ajax({
            url: "/airplanes",
            type: "GET",
            success: function(response) {
                getAirplane(response);
            },
            error: function(xhr) {
                showMessage(xhr.responseText);
            }
        });
    }

    function getAirplane(json) {
        var html ='<tr>' +
                '<th>Модель</th>' +
                '<th>Вместимость</th>' +
                '<th>ИД Авиалинии</th>' +
            '</tr>';

        $.each(json, function (index, value) {
            html = html +'<tr>';
            html = html + '<td align="center">  ' + value.model + '  </td>';
            html = html + '<td align="center">  ' + value.capacity + '  </td>';
            html = html + '<td align="center">  ' + value.airlineId + '  </td>';
            html = html + '</tr>';
        });

        html = '<table>' + '<caption>Самолеты</caption>' + html + '</table>';

        setContainer(html)
    }

    function deleteAirplane(id) {
        $.ajax({
            url: "/airplanes/" + id,
            type: "DELETE",
            success: function(response) {
                loadAirplanes()
            },
            error: function(xhr) {
                showMessage(xhr.responseText)
            }
        });
    }

    function setContainer(data) {
        $('#container').html(data);
    }

    function showMessage(msg) {
        alert(msg.toString())
    }
</script>